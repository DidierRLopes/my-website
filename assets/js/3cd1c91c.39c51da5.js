"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[34350],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},d="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(a),u=i,m=d["".concat(l,".").concat(u)]||d[u]||h[u]||o;return a?n.createElement(m,r(r({ref:t},c),{},{components:a})):n.createElement(m,r({ref:t},c))}));function m(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=a.length,r=new Array(o);r[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:i,r[1]=s;for(var p=2;p<o;p++)r[p]=a[p];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},39550:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var n=a(87462),i=(a(67294),a(3905));const o={slug:"creating-an-ai-powered-financial-analyst",title:"Creating an AI-powered financial analyst",date:new Date("2023-12-27T00:00:00.000Z"),image:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst.png",tags:["ai","llm","agents","tools","function calling","openbb"],description:"Our Platform aims to empower the OpenBB Copilot, an AI-powered financial analyst, to perform tasks ranging from knowledge retrieval to fully autonomous analysis. The architecture involves task decomposition, tool retrieval, and subtask agents, showcasing impressive results in both deterministic and non-deterministic workflows. Read on to explore its capabilities and don't forget to watch the demos."},r=void 0,s={permalink:"/blog/creating-an-ai-powered-financial-analyst",editUrl:"https://github.com/DidierRLopes/my-website/tree/main/blog/2023-12-27-creating-an-ai-powered-financial-analyst.md",source:"@site/blog/2023-12-27-creating-an-ai-powered-financial-analyst.md",title:"Creating an AI-powered financial analyst",description:"Our Platform aims to empower the OpenBB Copilot, an AI-powered financial analyst, to perform tasks ranging from knowledge retrieval to fully autonomous analysis. The architecture involves task decomposition, tool retrieval, and subtask agents, showcasing impressive results in both deterministic and non-deterministic workflows. Read on to explore its capabilities and don't forget to watch the demos.",date:"2023-12-27T00:00:00.000Z",formattedDate:"December 27, 2023",tags:[{label:"ai",permalink:"/blog/tags/ai"},{label:"llm",permalink:"/blog/tags/llm"},{label:"agents",permalink:"/blog/tags/agents"},{label:"tools",permalink:"/blog/tags/tools"},{label:"function calling",permalink:"/blog/tags/function-calling"},{label:"openbb",permalink:"/blog/tags/openbb"}],readingTime:9.01,hasTruncateMarker:!0,authors:[],frontMatter:{slug:"creating-an-ai-powered-financial-analyst",title:"Creating an AI-powered financial analyst",date:"2023-12-27T00:00:00.000Z",image:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst.png",tags:["ai","llm","agents","tools","function calling","openbb"],description:"Our Platform aims to empower the OpenBB Copilot, an AI-powered financial analyst, to perform tasks ranging from knowledge retrieval to fully autonomous analysis. The architecture involves task decomposition, tool retrieval, and subtask agents, showcasing impressive results in both deterministic and non-deterministic workflows. Read on to explore its capabilities and don't forget to watch the demos."},prevItem:{title:"Prediction for 2024",permalink:"/blog/prediction-for-2024"},nextItem:{title:"The new FinAI Tech Stack",permalink:"/blog/the-new-finai-tech-stack"}},l={authorsImageUrls:[]},p=[{value:"Introduction",id:"introduction",level:2},{value:"AI-Powered financial analyst roadmap",id:"ai-powered-financial-analyst-roadmap",level:2},{value:"Two types of prompts",id:"two-types-of-prompts",level:2},{value:"OpenBB Platform",id:"openbb-platform",level:2},{value:"OpenBB Tools",id:"openbb-tools",level:3},{value:"OpenBB Agent Architecture",id:"openbb-agent-architecture",level:2},{value:"Task Decomposition",id:"task-decomposition",level:3},{value:"Tool Retrieval",id:"tool-retrieval",level:3},{value:"Subtask Agents",id:"subtask-agents",level:3},{value:"Final Agent",id:"final-agent",level:3},{value:"OpenBB Results",id:"openbb-results",level:2},{value:"Prompt A",id:"prompt-a",level:3},{value:"Prompt B",id:"prompt-b",level:3}],c={toc:p},d="wrapper";function h(e){let{components:t,...a}=e;return(0,i.kt)(d,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst.png"})),(0,i.kt)("br",null),(0,i.kt)("p",null,"Our Platform aims to empower the OpenBB Copilot, an AI-powered financial analyst, to perform tasks ranging from knowledge retrieval to fully autonomous analysis. The architecture involves task decomposition, tool retrieval, and subtask agents, showcasing impressive results in both deterministic and non-deterministic workflows. Read on to explore its capabilities and don't forget to watch the demos."),(0,i.kt)("p",null,"The open source code is available ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/OpenBB-finance/openbb-agents"},"here"),"."),(0,i.kt)("div",{style:{borderTop:"1px solid #0088CC",margin:"1.5em 0"}}),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"At OpenBB, we have been thinking deeply about how AI will impact the lives of analysts and quants. We recently ",(0,i.kt)("a",{parentName:"p",href:"https://openbb.co/blog/goodbye-openbb-sdk-hello-openbb-platform"},"announced the OpenBB Platform")," and have refactored it from the ground up to make it easier and simpler for quants/developers to access financial data. In addition, we hired a new head of AI to lead our AI efforts - you can read more about it ",(0,i.kt)("a",{parentName:"p",href:"https://openbb.co/blog/revolutionizing-ai-at-openbb-with-new-leader-michael-struwig"},"here"),"."),(0,i.kt)("p",null,"I did a 20-minute presentation at the Open Core Summit on this topic that you can watch here:"),(0,i.kt)("div",{className:"flex place-items-center justify-center items-center rounded-sm mx-auto"},(0,i.kt)("iframe",{src:"https://www.youtube.com/embed/A-43EKK2PhE?si=o_lO_lVLpWwwfbvF",width:"800",height:"400"})),(0,i.kt)("br",null),(0,i.kt)("p",null,"Otherwise, the following post will summarize what we presented."),(0,i.kt)("h2",{id:"ai-powered-financial-analyst-roadmap"},"AI-Powered financial analyst roadmap"),(0,i.kt)("p",null,"When discussing what tasks we wanted our AI-powered Financial Analyst to be able to perform, we arrived at the following levels (in order of complexity):"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Knowledge retrieval"),': The agent can answer general financial queries without external resources. (eg. ChatGPT "as-is"). Here, the agent relies solely on its training data to answer questions.')),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Data retrieval"),": The agent can answer queries using information inserted into the context (usually as part of a separate data retrieval process that isn\u2019t controlled by the model, such as using ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Similarity_search"},"similarity search")," across a knowledge database using the user\u2019s query).")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Autonomous data retrieval"),": The agent can answer queries by dynamically retrieving data not currently present in the context or the training data via function calling.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Complex workflow execution"),": The agent can reason and answer queries that require a logical arrangement of knowledge retrieval, data retrieval, and autonomous data retrieval calling. It includes action planning and decision-making.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Fully autonomous analyst"),": The agent can do all of the above but is self-directed. The agent can dynamically generate additional hypotheses, modify plans of action, and retrieve the necessary data, all while mid-workflow. The agent can make arguments for certain decisions, carry a discussion on the topic, and reason with you."))),(0,i.kt)("p",null,"Our goal is to enable OpenBB Copilot to perform all of the above. I presented a demo of how it would work in this video:"),(0,i.kt)("div",{className:"flex place-items-center justify-center items-center rounded-sm mx-auto"},(0,i.kt)("iframe",{src:"https://www.youtube.com/embed/V1rYmWWVbIY?si=ShScenxTI4bHtERS",width:"800",height:"400"})),(0,i.kt)("br",null),(0,i.kt)("h2",{id:"two-types-of-prompts"},"Two types of prompts"),(0,i.kt)("p",null,"Rather than first building an AI-powered financial analyst for the sake of it, we instead started from what we wanted to achieve. We came up with two distinct prompts and our goal was for the agent to be able to successfully perform both of these, but utilizing the same underlying \u201cagentic\u201d architecture."),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_1.png"})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Prompt A (on the left)")," - requires linear reasoning (where future answers depend on previous answers). This kind of prompt is generally deterministic, which allows us to access (and verify) the agent\u2019s answers immediately because we can check the underlying facts and data. It also involves a few complex operations across multiple steps, such as extracting a list of tickers from an endpoint and iterating through that list using a different endpoint. Then based on those outputs, a reasoning can be made and a final answer is given.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Prompt B (on the right)")," - requires independent reasoning (fetching and combining different pieces of independent information). This prompt is typically less deterministic and allows us to leverage LLMs to provide alpha by uncovering insights that would be hard for a human to discover (or, at the very least, discover at scale). Instead of telling the agent what to do explicitly, we instead pose a question and expect the agent to execute an analysis and perform reasoning, without specific guidance or guardrails."))),(0,i.kt)("h2",{id:"openbb-platform"},"OpenBB Platform"),(0,i.kt)("p",null,"Getting started with our Platform is extremely easy (docs ",(0,i.kt)("a",{parentName:"p",href:"https://docs.openbb.co/platform"},"here"),"). All you need is ",(0,i.kt)("inlineCode",{parentName:"p"},"pip install openbb")," and you are ready to access 100+ different datasets."),(0,i.kt)("p",null,"We standardize the data so that you can read our docs once and interact with the Platform the same way, regardless of the type of data you are looking at."),(0,i.kt)("p",null,"In addition, using the OpenBB Hub, you can set up your API keys which we can manage on your behalf, and all you need to access data via OpenBB is a Personal Access Token."),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_2.png"})),(0,i.kt)("p",null,"Crucially, we use Pydantic for all of our endpoints. This ensures that we have both structured inputs and structured outputs. This is extremely important as we feed these models into our agent so that it understands both the input schema during function calling, but also the output schema of the resulting function call. This is standardized across multiple data vendors across the OpenBB Platform."),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_3.png"})),(0,i.kt)("h3",{id:"openbb-tools"},"OpenBB Tools"),(0,i.kt)("p",null,"From having 100+ different data endpoints that you can access using Python, we created \u201ctools\u201d that an agent \u201cunderstands\u201d and can use. This is extremely important since this collection of tools will give real-time data to the agent based on the prompt asked."),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_4.png"})),(0,i.kt)("p",null,"Since the OpenBB Platform has high-quality documentation, we use each function\u2019s docstring as well as the output field names (with some basic preprocessing). This tweak allows the agent to know where to get the market cap information from, even if it\u2019s within a differently-named endpoint (for example the ",(0,i.kt)("inlineCode",{parentName:"p"},"equity.fundamentals.overview")," endpoint)."),(0,i.kt)("p",null,"Each of these tool descriptions is converted into embeddings that can be retrieved later on based on the query the user provides. This allows our agent to pick the right tools for the job - i.e. if I want to have access to Apple\u2019s market cap, I want to get the tool ",(0,i.kt)("inlineCode",{parentName:"p"},"equity.fundamentals.overview")," because I know that by providing the symbol ",(0,i.kt)("inlineCode",{parentName:"p"},"AAPL")," I can get the market cap value."),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_5.png"})),(0,i.kt)("p",null,"So, we create a vector store using FAISS (Facebook AI Similarity Search) and OpenAIEmbeddings, although any vector store with similarity search would also work."),(0,i.kt)("h2",{id:"openbb-agent-architecture"},"OpenBB Agent Architecture"),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_6.png"})),(0,i.kt)("p",null,"This is the overall architecture that our agent will follow, and below we will talk about each of these components individually."),(0,i.kt)("h3",{id:"task-decomposition"},"Task Decomposition"),(0,i.kt)("p",null,"First of all, we don\u2019t want to tackle the user query in one go. This is because LLMs have limited context. Plus, we want the agent to retrieve all the necessary tools to answer the query. But the vector\u2019s store similarity search doesn\u2019t work with one prompt that needs multiple different tools. Additionally, similar to human analysts, breaking a larger question up into smaller manageable subquestions leads to better analysis and results."),(0,i.kt)("p",null,"So, we break the user\u2019s main query into:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"List of simpler tasks"),": self-explanatory")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"List of tasks dependency"),": does the current subtask need a prior subtask to tackle the current subtask?")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"List of \u201ctool search\u201d keywords associated with each subtask"),": instead of using the subtask question itself to directly retrieve the correct selection of tools using the embeddings in the vector store, empirically we found that if the LLM could select the most important keywords associated with the task using keyword search. This ended up resulting in a big jump in retrieval performance. This is expected since we are effectively reducing the noise. E.g. \u201cWhat are Tesla peers\u201d \u2192 \u201cpeers\u201d."))),(0,i.kt)("p",null,"This is the system message we are utilizing:"),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_7.png"})),(0,i.kt)("p",null,"To ensure that we have a structured output with the format specified, we create a Pydantic Data model to be used as format in the instruction:"),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_8.png"})),(0,i.kt)("p",null,"This is what the code looks like, and you can see that the ",(0,i.kt)("inlineCode",{parentName:"p"},"PydanticOutputParser")," goes into the ",(0,i.kt)("inlineCode",{parentName:"p"},"format_instructions"),":"),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_9.png"})),(0,i.kt)("h3",{id:"tool-retrieval"},"Tool Retrieval"),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_10.png"})),(0,i.kt)("p",null,"This is the function that the agent uses to retrieve the right subset of tools to answer each of the subtasks. Empirically, we found good results by using the similarity score threshold of 0.65. In other words, we retrieve all tools with descriptions that return a better similarity score than that value. In the case where the search yields less than two tools, we return the 2 tools with the highest similarity score instead."),(0,i.kt)("p",null,"As previously mentioned, you can see that we are not using the subtask query itself but the keywords associated with it. The embeddings of the keywords are (from experimentation) closer to the embeddings of the correct docstring by focusing solely on a few keywords rather than the entire sentence."),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_11.png"})),(0,i.kt)("h3",{id:"subtask-agents"},"Subtask Agents"),(0,i.kt)("p",null,"Each subtask agent is provided with the original query from the user, one of the subtasks from the task decomposition step, the output from another subtask agent IF there was a subtask dependency AND a set of retrieved tools necessary to answer the subtask."),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_12.png"})),(0,i.kt)("p",null,"This is what the agent looks like:"),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_13.png"})),(0,i.kt)("h3",{id:"final-agent"},"Final Agent"),(0,i.kt)("p",null,"We then combine the entire context from subquestions and outputs to be given to the final agent:"),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_14.png"})),(0,i.kt)("p",null,"Finally, we give the final agent the main prompt and the list of tasks from task decomposition and that\u2019s it!"),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_15.png"})),(0,i.kt)("h2",{id:"openbb-results"},"OpenBB Results"),(0,i.kt)("h3",{id:"prompt-a"},"Prompt A"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},'"Check what are TSLA peers. From those, check which one has the highest market cap. Then, on the ticker that has the highest market cap get the most recent price target estimate from an analyst, and tell me who it was and on what date the estimate was made."')),(0,i.kt)("p",null,"The output can be seen here:"),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_16.png"})),(0,i.kt)("p",null,"Since this is a deterministic workflow, we can look at the raw data to check whether the output is correct or not - which we can validate below."),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_17.png"})),(0,i.kt)("h3",{id:"prompt-b"},"Prompt B"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"\u201cPerform a fundamentals financial analysis of AMZN using the most recently available data. What do you find that\u2019s interesting?\u201d")),(0,i.kt)("p",null,"The output can be seen here:"),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_18.png"})),(0,i.kt)("p",{align:"center"},(0,i.kt)("img",{width:"600",src:"/blog/2023-12-27-creating-an-ai-powered-financial-analyst_19.png"})),(0,i.kt)("p",null,"As can be seen above, the results are extremely impressive. We achieved this with a couple of weeks of work, but there are still a lot of areas that we can improve and in which we are currently working on. However, the current results make this an extremely exciting space to be."),(0,i.kt)("p",null,"All this work is open source and can be found on GitHub ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/OpenBB-finance/openbb-agents"},"here"),"."),(0,i.kt)("p",null,"We are just getting started."))}h.isMDXComponent=!0}}]);