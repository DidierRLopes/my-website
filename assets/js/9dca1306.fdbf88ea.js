"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[86617],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>d});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=n.createContext({}),h=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},p=function(e){var t=h(e.components);return n.createElement(l.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,s=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=h(a),m=o,d=u["".concat(l,".").concat(m)]||u[m]||c[m]||s;return a?n.createElement(d,r(r({ref:t},p),{},{components:a})):n.createElement(d,r({ref:t},p))}));function d(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=a.length,r=new Array(s);r[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[u]="string"==typeof e?e:o,r[1]=i;for(var h=2;h<s;h++)r[h]=a[h];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},53366:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>c,frontMatter:()=>s,metadata:()=>i,toc:()=>h});var n=a(87462),o=(a(67294),a(3905));const s={slug:"how-to-use-openai-to-extract-insights-from-team-survey",title:"How to Use OpenAI to Extract Insights from Team Survey",date:new Date("2023-07-21T00:00:00.000Z"),image:"https://github-production-user-asset-6210df.s3.amazonaws.com/88618738/280556043-a80c7f1b-f119-4a33-83e3-8eb5aa10e6f2.png",tags:["OpenAI","Team Survey","Insights","Automation","Slack","Airtable"],description:"This blog post discusses how to use OpenAI to extract insights from team survey data. It covers the motivation behind the project, the requirements, and the implementation process, including the use of the Slack API and Airtable API for automation."},r=void 0,i={permalink:"/blog/how-to-use-openai-to-extract-insights-from-team-survey",editUrl:"https://github.com/DidierRLopes/my-website/tree/main/blog/blog/2023-07-21-how-to-use-openai-to-extract-insights-from-team-survey.md",source:"@site/blog/2023-07-21-how-to-use-openai-to-extract-insights-from-team-survey.md",title:"How to Use OpenAI to Extract Insights from Team Survey",description:"This blog post discusses how to use OpenAI to extract insights from team survey data. It covers the motivation behind the project, the requirements, and the implementation process, including the use of the Slack API and Airtable API for automation.",date:"2023-07-21T00:00:00.000Z",formattedDate:"July 21, 2023",tags:[{label:"OpenAI",permalink:"/blog/tags/open-ai"},{label:"Team Survey",permalink:"/blog/tags/team-survey"},{label:"Insights",permalink:"/blog/tags/insights"},{label:"Automation",permalink:"/blog/tags/automation"},{label:"Slack",permalink:"/blog/tags/slack"},{label:"Airtable",permalink:"/blog/tags/airtable"}],readingTime:8.01,hasTruncateMarker:!0,authors:[],frontMatter:{slug:"how-to-use-openai-to-extract-insights-from-team-survey",title:"How to Use OpenAI to Extract Insights from Team Survey",date:"2023-07-21T00:00:00.000Z",image:"https://github-production-user-asset-6210df.s3.amazonaws.com/88618738/280556043-a80c7f1b-f119-4a33-83e3-8eb5aa10e6f2.png",tags:["OpenAI","Team Survey","Insights","Automation","Slack","Airtable"],description:"This blog post discusses how to use OpenAI to extract insights from team survey data. It covers the motivation behind the project, the requirements, and the implementation process, including the use of the Slack API and Airtable API for automation."},prevItem:{title:"Keep track of your startup metrics using a custom iOS widget",permalink:"/blog/keep-track-of-your-startup-metrics-using-a-custom-ios-widget"},nextItem:{title:"Why the need for an open source investment research platform?",permalink:"/blog/why-the-need-for-an-open-source-investment-research-platform"}},l={authorsImageUrls:[]},h=[{value:"Motivation",id:"motivation",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Slack API",id:"slack-api",level:3},{value:"Airtable API",id:"airtable-api",level:3},{value:"OpenAI API",id:"openai-api",level:3},{value:"Glue it together",id:"glue-it-together",level:2},{value:"Automate with GitHub workflow",id:"automate-with-github-workflow",level:2},{value:"When",id:"when",level:3},{value:"Secrets",id:"secrets",level:3},{value:"Workflow",id:"workflow",level:3}],p={toc:h},u="wrapper";function c(e){let{components:t,...a}=e;return(0,o.kt)(u,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",{align:"center"},(0,o.kt)("img",{width:"600",src:"https://github-production-user-asset-6210df.s3.amazonaws.com/88618738/280556043-a80c7f1b-f119-4a33-83e3-8eb5aa10e6f2.png"})),(0,o.kt)("br",null),(0,o.kt)("p",null,"This blog post discusses how to use OpenAI to extract insights from team survey data. It covers the motivation behind the project, the requirements, and the implementation process, including the use of the Slack API and Airtable API for automation."),(0,o.kt)("p",null,"The open source code is available ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/DidierRLopes/insights-from-team-survey"},"here"),"."),(0,o.kt)("div",{style:{borderTop:"1px solid #21af90",margin:"1.5em 0"}}),(0,o.kt)("h2",{id:"motivation"},"Motivation"),(0,o.kt)("p",null,"I\u2019ve been wanting to play with the OpenAI API for a while, but I\u2019ve had higher priority tasks. Yesterday, I thought that I could use the day to do this, but I didn\u2019t want to just try it in a notebook. Instead, I wanted to use it in a real project that could save me time."),(0,o.kt)("p",null,"Last week, I posted about how at OpenBB we have developed a monthly team survey and automated the process of requesting information through Slack and Airtable. You can find more on that post ",(0,o.kt)("a",{parentName:"p",href:"/blog/employees-are-leaving-be-proactive-about-employee-feedback"},"here"),"."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://github.com/Meg1211/my-website/assets/88618738/e1c2c71d-6a6b-4c3b-a0ca-28e848e78e7a",alt:"image"})),(0,o.kt)("p",null,"This made me think that even though I have access to all this data, which OpenBB has made fully available ",(0,o.kt)("a",{parentName:"p",href:"https://openbb.co/open"},"here"),", I still have to spend some time looking at the data to extract insights."),(0,o.kt)("img",{width:"1397",alt:"Screenshot 2023-11-24 at 4 39 41 PM",src:"https://github.com/DidierRLopes/my-website/assets/25267873/f26e7274-51ec-4e38-b8b9-b45ebafeba64"}),(0,o.kt)("p",null,"What if I could automate that analysis using OpenAI? This is what I set out to build, and this post will focus on how I went from idea to implementation."),(0,o.kt)("h2",{id:"requirements"},"Requirements"),(0,o.kt)("p",null,"I already had a notebook that I used to analyze our Airtable data with our team survey in it. However, that analysis was quite \u201cheavy,\u201d and it was not straightforward to extract insights. Thus, one of the requirements was to use OpenAI to analyze the team survey feedback for the current month and highlight anything worth mentioning."),(0,o.kt)("p",null,"Additionally, I wanted to compare the team\u2019s experience to the prior month to understand if we were improving or not, and identify areas for further improvement. Finally, based on these insights, I wanted OpenAI to suggest what OpenBB, as a company, could do to improve our culture."),(0,o.kt)("p",null,"To achieve this using an OpenAI model, I could either export the team survey responses from Airtable in CSV and copy-paste them into ChatGPT, or I could automate the data retrieval using the Airtable API. Being an engineer, why would I do something in 5 minutes when I can spend 1 day automating it? \ud83e\udd23"),(0,o.kt)("p",null,"Lastly, I didn\u2019t want to run this script and have to copy-paste the output into our Slack group so that everyone on the team could have access to the overall analysis and provide feedback/suggestions. Therefore, I would like to have a Slack integration that sends the output in a specific formatted way to our Slack channel."),(0,o.kt)("p",null,"So, the idea is as follows:"),(0,o.kt)("ol",null,(0,o.kt)("li",null,"Retrieve team feedback responses from Airtable"),(0,o.kt)("li",null,"Extract insights from the team survey data using OpenAI"),(0,o.kt)("li",null,"Send the insights output to the OpenBB Slack channel")),(0,o.kt)("h2",{id:"implementation"},"Implementation"),(0,o.kt)("h3",{id:"slack-api"},"Slack API"),(0,o.kt)("p",null,"First of all, I went to the ",(0,o.kt)("a",{parentName:"p",href:"https://api.slack.com/apps"},"Slack API")," page. There, I created an app named \u201cEmployee Voice\u201d and selected the \u201cOpenBB\u201d workspace, as shown below:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://github.com/Meg1211/my-website/assets/88618738/d2d88e11-f81b-472f-b073-0aa195e7d9d6",alt:"image"})),(0,o.kt)("p",null,"After clicking \u201cCreate App\u201d I proceeded to update the display information."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://github.com/Meg1211/my-website/assets/88618738/e11533e2-424c-4828-b520-3e5235cc69fb",alt:"image"})),(0,o.kt)("p",null,"Then I go into \u201cIncoming Webhooks\u201d and select the channel I\u2019m interested in posting messages to. That should be all the settings you need to configure for your app."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://github.com/Meg1211/my-website/assets/88618738/ed08fcb7-43d7-4510-b43d-13606bcd5d1d",alt:"image"})),(0,o.kt)("p",null,"The webhook URL will be necessary, so I copied it and added it to the following script. For the channel name, I used my personal name, \u201c",(0,o.kt)("em",{parentName:"p"},"Didier Lopes"),"\u201d, since I was just testing if it worked. As for the message, I used the infamous \u201cHello World\u201d text."),(0,o.kt)("p",null,"Here is a sample that you can use to test whether you can successfully send yourself a direct message using the Slack API."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'    SLACK_WEBHOOK_URL=<Webhook URL mentioned above>\n    \n    insight="Hello World"\n    \n    payload = {\n        \'text\': insight,\n    }\n    \n    req = Request(SLACK_WEBHOOK_URL, json.dumps(payload).encode(\'utf-8\'))\n    try:\n        response = urlopen(req)\n        response.read()\n        \n        print("SUCCESS: Message with insights sent to slack\\n")\n    except HTTPError as e:\n        print(f"Request failed: {e.code} {e.reason}\\n")\n    except URLError as e:\n        print(f"Server connection failed: {e.reason}\\n")\n')),(0,o.kt)("h3",{id:"airtable-api"},"Airtable API"),(0,o.kt)("p",null,"At OpenBB, we are using Airtable to automate the monthly team survey questionnaire and store the associated data. I wrote more about that process in ",(0,o.kt)("a",{parentName:"p",href:"/blog/employees-are-leaving-be-proactive-about-employee-feedback"},"this blog"),"."),(0,o.kt)("p",null,"Now, I want to have programmatic access to this data."),(0,o.kt)("p",null,"Firstly, I need to obtain the Airtable API key, which you can get from the ",(0,o.kt)("a",{parentName:"p",href:"https://airtable.com/create/tokens"},"Airtable Developer Hub"),". Secondly, I navigate to Airtable and locate the table that contains the data of interest, as shown below:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://github.com/Meg1211/my-website/assets/88618738/91b2ac4a-d18a-4083-a422-bb9c85a3ae8c",alt:"image"})),(0,o.kt)("p",null,"The name of the table, \u201c",(0,o.kt)("em",{parentName:"p"},"OpenBB_monthly"),"\u201d, corresponds to the \u201cTABLE NAME\u201d that will be necessary. Additionally, when you are on this table view, your URL will have the following format: ",(0,o.kt)("a",{parentName:"p",href:"https://airtable.com/XXX"},"https://airtable.com/XXX"),". That XXX is your \u201cBASE ID,\u201d which will be the final element necessary to retrieve data from Airtable."),(0,o.kt)("p",null,"Next, run the following script to ensure that you have access to this data."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"    AIRTABLE_API_KEY=<Located in Airtable Developer Hub>\n    AIRTABLE_BASE_ID=<Located in URL when accessing data>\n    AIRTABLE_TABLE_NAME=\"OpenBB_monthly\"\n    \n    response = requests.get(\n        url=f'https://api.airtable.com/v0/{AIRTABLE_BASE_ID}/{AIRTABLE_TABLE_NAME}',\n        headers={'Authorization': f'Bearer {AIRTABLE_API_KEY}'}\n    )\n    \n    Check if the data has been loaded correctly\n    if response.status_code == 200:\n        data = response.json()[\"records\"]\n    else:\n        print(f\"Error: {response.status_code}\")\n    \n    print(data)\n")),(0,o.kt)("h3",{id:"openai-api"},"OpenAI API"),(0,o.kt)("p",null,"Finally, go to ",(0,o.kt)("a",{parentName:"p",href:"https://platform.openai.com/account/api-keys"},"OpenAI Developer platform")," and grab your OpenAI API key."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://github.com/Meg1211/my-website/assets/88618738/e6e9b5b8-cb5e-4c34-aabb-2027c1f67ad1",alt:"image"})),(0,o.kt)("p",null,"Once you have that, you are pretty much ready to test whether this works or not. In this case, we assume you have access to the data from Airtable, so you can test if the OpenAI code is set up correctly with the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'    data_previous_month=<dataframe with raw survey data from previous month>\n    data_current_month=<dataframe with raw survey data from current month>\n    current_month=<current month date>\n    \n    openai.api_key=<Located in OpenAI Developer platform>\n    response = openai.ChatCompletion.create(\n    model="gpt-4",  # you can use a different model\n    messages=[\n            {"role": "system", "content": "You are a Chief of Staff with a MSc. in Data analysis and are trying to improve the culture of the company."},\n            {"role": "user", \n            "content": \n                f"""\n        This table represents the company survey for the previous month: {data_previous_month}\n    \n        This table represents the company survey for this month: {data_current_month}.\n    \n        Based on this data, can you do 3 things:\n        \n        1. Summarize main differences since last month\n        2. Summarize main highlights for current month\n        3. Create suggestions for what could be done to improve those areas\n        \n        Please use the following format for the output:\n            As the title use the following: Insights from team survey in {current_month}.\n            Follow the title by 2 line breaks.\n            Use bullet points within each of the points mentioned above.\n            Between the 3 points, use 1 line breaks, a line with ----------------------- and another line break.\n            Use `` when referring to a component like `Reward` or `Growth`.\n            Do not use asterisks \'*\' or \'**\'.\n            When referring to to Engineering or Product, Marketing, Design, Finance wrap them around asterisk, e.g. _Engineering_.\n                """\n            },\n        ]\n    )\n    \n    print(response.choices[0].message.content)\n')),(0,o.kt)("h2",{id:"glue-it-together"},"Glue it together"),(0,o.kt)("p",null,"Once you have the scripts, merging them is straightforward. I will show you what the input vs. output looks like."),(0,o.kt)("p",null,"Here is ",(0,o.kt)("a",{parentName:"p",href:"http://openbb.co/"},"OpenBB"),"\u2019s team survey data from June of 2023:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://github.com/Meg1211/my-website/assets/88618738/cfadfada-6841-4f21-8cbe-689761aa1333",alt:"image"})),(0,o.kt)("p",null,"If I run the script here, as shown below (yes, you guessed it right \u2014 I open-sourced this project as usual. I hope you and your team find it useful):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-console"},"    $ python extract_insights_from_last_team_survey.py\n")),(0,o.kt)("p",null,"This is the expected output if the script runs successfully."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-console"},"    Loading environment variables...\n    Loading team survey data from Airtable...\n    Processing data from Airtable...\n    Extracting insights from team survey data...\n    Sending insights to Slack through a message...\n    SUCCESS: Message with insights sent to slack\n")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://github.com/Meg1211/my-website/assets/88618738/17871455-02b0-4b30-867a-2b9efdd97b15",alt:"image"})),(0,o.kt)("h2",{id:"automate-with-github-workflow"},"Automate with GitHub workflow"),(0,o.kt)("p",null,"We\u2019re almost there! It doesn\u2019t make sense for us to manually run this script every month. Plus, software engineers are known for their laziness (which is actually a ",(0,o.kt)("a",{parentName:"p",href:"https://thethreevirtues.com/"},"virtue of a great programmer"),"), so let\u2019s create a GitHub action to automate this process."),(0,o.kt)("p",null,"To begin, create a file called \u201cmain.yml\u201d in the \u201c.github/workflows\u201d directory."),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/DidierRLopes/insights-from-team-survey/blob/main/.github/workflows/main.yml"},"This workflow")," will be divided into three main sections:"),(0,o.kt)("h3",{id:"when"},"When"),(0,o.kt)("p",null,"Specifies when this GitHub action should run."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-console"},"    on:\n      push:\n        branches:\n          - main\n      schedule:\n        - cron: '0 0 3 * *'\n")),(0,o.kt)("p",null,"The first section, \u201con: push: branches: ","[main]","\u201d means that whenever there is a code push to the \u201cmain\u201d branch, this workflow will be triggered. This feature allows us to quickly test whether the action is functioning as expected."),(0,o.kt)("p",null,"The \u201cschedule-cron\u201d makes it so that the yaml gets run at a specific dates and times."),(0,o.kt)("h3",{id:"secrets"},"Secrets"),(0,o.kt)("p",null,"What do we need in advance for this to work?"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-console"},"    env:\n      SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}\n      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}\n      AIRTABLE_API_KEY: ${{ secrets.AIRTABLE_API_KEY }}\n      AIRTABLE_BASE_ID: ${{ secrets.AIRTABLE_BASE_ID }}\n      AIRTABLE_TABLE_NAME: ${{ secrets.AIRTABLE_TABLE_NAME }}\n")),(0,o.kt)("p",null,"All of these variables need to be set as action secrets. You can do this by selecting the \u201cSettings\u201d tab above, then going into \u201cScripts and variables,\u201d and selecting \u201cNew repository secret.\u201d Fill in the information accordingly, as shown below:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://github.com/Meg1211/my-website/assets/88618738/b0f054a3-4b55-47ac-a34a-678b7edbed86",alt:"image"})),(0,o.kt)("h3",{id:"workflow"},"Workflow"),(0,o.kt)("p",null,"What commands are we running with this GitHub action? In our case, these are the ones we are interested in."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-console"},"    jobs:\n      build:\n        runs-on: ubuntu-latest\n    \n        steps:\n          - name: checkout repo content\n            uses: actions/checkout@v2\n    \n          - name: setup python\n            uses: actions/setup-python@v2\n            with:\n              python-version: 3.9\n    \n          - name: install python packages\n            run: |\n              python -m pip install --upgrade pip\n              pip install python-dotenv\n              pip install pandas\n              pip install openai\n    \n          - name: extract insights from team feedback\n            run: |\n              python extract_insights_from_last_team_survey.py\n")),(0,o.kt)("p",null,"And that\u2019s it! You now have a complete automation pipeline from employee feedback to insights within seconds."),(0,o.kt)("p",null,"I hope you enjoyed reading this post, and I would love to hear your feedback. Do you appreciate the level of technical detail I go into, or would you prefer less?"),(0,o.kt)("p",null,"Any comments are very helpful. Thank you!"))}c.isMDXComponent=!0}}]);