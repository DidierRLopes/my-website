<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Creating an AI-powered financial analyst | Didier Lopes</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://didierlopes.com/blog/creating-an-ai-powered-financial-analyst"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Creating an AI-powered financial analyst | Didier Lopes"><meta data-rh="true" name="description" content="Our Platform aims to empower the OpenBB Copilot, an AI-powered financial analyst, to perform tasks ranging from knowledge retrieval to fully autonomous analysis. The architecture involves task decomposition, tool retrieval, and subtask agents, showcasing impressive results in both deterministic and non-deterministic workflows. Read on to explore its capabilities and don&#x27;t forget to watch the demos."><meta data-rh="true" property="og:description" content="Our Platform aims to empower the OpenBB Copilot, an AI-powered financial analyst, to perform tasks ranging from knowledge retrieval to fully autonomous analysis. The architecture involves task decomposition, tool retrieval, and subtask agents, showcasing impressive results in both deterministic and non-deterministic workflows. Read on to explore its capabilities and don&#x27;t forget to watch the demos."><meta data-rh="true" property="og:image" content="https://didierlopes.com/blog/2023-12-27-creating-an-ai-powered-financial-analyst.png"><meta data-rh="true" name="twitter:image" content="https://didierlopes.com/blog/2023-12-27-creating-an-ai-powered-financial-analyst.png"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-12-27T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="openbb,ai,llm,agents,copilot,function-calling,pydantic,langchain"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://didierlopes.com/blog/creating-an-ai-powered-financial-analyst"><link data-rh="true" rel="alternate" href="https://didierlopes.com/blog/creating-an-ai-powered-financial-analyst" hreflang="en"><link data-rh="true" rel="alternate" href="https://didierlopes.com/blog/creating-an-ai-powered-financial-analyst" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://CTGM87XQE8-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://didierlopes.com/blog/creating-an-ai-powered-financial-analyst","mainEntityOfPage":"https://didierlopes.com/blog/creating-an-ai-powered-financial-analyst","url":"https://didierlopes.com/blog/creating-an-ai-powered-financial-analyst","headline":"Creating an AI-powered financial analyst","name":"Creating an AI-powered financial analyst","description":"Our Platform aims to empower the OpenBB Copilot, an AI-powered financial analyst, to perform tasks ranging from knowledge retrieval to fully autonomous analysis. The architecture involves task decomposition, tool retrieval, and subtask agents, showcasing impressive results in both deterministic and non-deterministic workflows. Read on to explore its capabilities and don't forget to watch the demos.","datePublished":"2023-12-27T00:00:00.000Z","author":[],"image":{"@type":"ImageObject","@id":"https://didierlopes.com/blog/2023-12-27-creating-an-ai-powered-financial-analyst.png","url":"https://didierlopes.com/blog/2023-12-27-creating-an-ai-powered-financial-analyst.png","contentUrl":"https://didierlopes.com/blog/2023-12-27-creating-an-ai-powered-financial-analyst.png","caption":"title image for the blog post: Creating an AI-powered financial analyst"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://didierlopes.com/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Didier Lopes RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Didier Lopes Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Didier Lopes JSON Feed">




<link rel="search" type="application/opensearchdescription+xml" title="Didier Lopes" href="/opensearch.xml">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-PL77JR5L",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>


<link rel="stylesheet" href="src/css/custom.css"><link rel="stylesheet" href="/assets/css/styles.aedbf6b5.css">
<script src="/assets/js/runtime~main.e97e3d6f.js" defer="defer"></script>
<script src="/assets/js/main.d0e7601e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script>

<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PL77JR5L" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/"><div class="navbar__logo"><img src="/img/goku.png" alt="Goku NFT" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/goku.png" alt="Goku NFT" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Didier Lopes</b></a><div class="navbar__item"><div class="navbar__items--left-wrapper"></div><a class="navbar__item navbar__link" href="/books/to-read">Books</a><a class="navbar__item navbar__link" href="/media/on-stage">Media</a><a class="navbar__item navbar__link" href="/resume/experience">Resume</a><div class="navbar__item"></div></div><a aria-current="page" class="navbar__item navbar__link navbar__center-item navbar__link--active" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/intelligence">Intelligence</a><a class="navbar__item navbar__link" href="/chat">Chat</a><a href="/newsletter" class="navbar__item navbar__link navbar-item-external navbar-newsletter-link" target="_blank" rel="noopener noreferrer">Newsletter</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-1"><div><article class=""><header><h1 class="title_f1Hy">Creating an AI-powered financial analyst</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-12-27T00:00:00.000Z">December 27, 2023</time> · <!-- -->11 min read</div></header><div id="__blog-post-container" class="markdown"><p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst.png"></p>
<br>
<p>Our Platform aims to empower the OpenBB Copilot, an AI-powered financial analyst, to perform tasks ranging from knowledge retrieval to fully autonomous analysis. The architecture involves task decomposition, tool retrieval, and subtask agents, showcasing impressive results in both deterministic and non-deterministic workflows. Read on to explore its capabilities and don&#x27;t forget to watch the demos.</p>
<p>The open source code is available <a href="https://github.com/OpenBB-finance/openbb-agents" target="_blank" rel="noopener noreferrer">here</a>.</p>
<div style="border-top:1px solid #0088CC;margin:1.5em 0"></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2>
<p>At OpenBB, we have been thinking deeply about how AI will impact the lives of analysts and quants. We recently <a href="https://openbb.co/blog/goodbye-openbb-sdk-hello-openbb-platform" target="_blank" rel="noopener noreferrer">announced the OpenBB Platform</a> and have refactored it from the ground up to make it easier and simpler for quants/developers to access financial data. In addition, we hired a new head of AI to lead our AI efforts - you can read more about it <a href="https://openbb.co/blog/revolutionizing-ai-at-openbb-with-new-leader-michael-struwig" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>I did a 20-minute presentation at the Open Core Summit on this topic that you can watch here:</p>
<div class="flex place-items-center justify-center items-center rounded-sm mx-auto"><iframe src="https://www.youtube.com/embed/A-43EKK2PhE?si=o_lO_lVLpWwwfbvF" width="800" height="400"></iframe></div>
<br>
<p>Otherwise, the following post will summarize what we presented.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ai-powered-financial-analyst-roadmap">AI-Powered financial analyst roadmap<a href="#ai-powered-financial-analyst-roadmap" class="hash-link" aria-label="Direct link to AI-Powered financial analyst roadmap" title="Direct link to AI-Powered financial analyst roadmap">​</a></h2>
<p>When discussing what tasks we wanted our AI-powered Financial Analyst to be able to perform, we arrived at the following levels (in order of complexity):</p>
<ol>
<li>
<p><strong>Knowledge retrieval</strong>: The agent can answer general financial queries without external resources. (eg. ChatGPT &quot;as-is&quot;). Here, the agent relies solely on its training data to answer questions.</p>
</li>
<li>
<p><strong>Data retrieval</strong>: The agent can answer queries using information inserted into the context (usually as part of a separate data retrieval process that isn&#x27;t controlled by the model, such as using <a href="https://en.wikipedia.org/wiki/Similarity_search" target="_blank" rel="noopener noreferrer">similarity search</a> across a knowledge database using the user&#x27;s query).</p>
</li>
<li>
<p><strong>Autonomous data retrieval</strong>: The agent can answer queries by dynamically retrieving data not currently present in the context or the training data via function calling.</p>
</li>
<li>
<p><strong>Complex workflow execution</strong>: The agent can reason and answer queries that require a logical arrangement of knowledge retrieval, data retrieval, and autonomous data retrieval calling. It includes action planning and decision-making.</p>
</li>
<li>
<p><strong>Fully autonomous analyst</strong>: The agent can do all of the above but is self-directed. The agent can dynamically generate additional hypotheses, modify plans of action, and retrieve the necessary data, all while mid-workflow. The agent can make arguments for certain decisions, carry a discussion on the topic, and reason with you.</p>
</li>
</ol>
<p>Our goal is to enable OpenBB Copilot to perform all of the above. I presented a demo of how it would work in this video:</p>
<div class="flex place-items-center justify-center items-center rounded-sm mx-auto"><iframe src="https://www.youtube.com/embed/V1rYmWWVbIY?si=ShScenxTI4bHtERS" width="800" height="400"></iframe></div>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="two-types-of-prompts">Two types of prompts<a href="#two-types-of-prompts" class="hash-link" aria-label="Direct link to Two types of prompts" title="Direct link to Two types of prompts">​</a></h2>
<p>Rather than first building an AI-powered financial analyst for the sake of it, we instead started from what we wanted to achieve. We came up with two distinct prompts and our goal was for the agent to be able to successfully perform both of these, but utilizing the same underlying &quot;agentic&quot; architecture.</p>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_1.png"></p>
<ul>
<li>
<p><strong>Prompt A (on the left)</strong> - requires linear reasoning (where future answers depend on previous answers). This kind of prompt is generally deterministic, which allows us to access (and verify) the agent&#x27;s answers immediately because we can check the underlying facts and data. It also involves a few complex operations across multiple steps, such as extracting a list of tickers from an endpoint and iterating through that list using a different endpoint. Then based on those outputs, a reasoning can be made and a final answer is given.</p>
</li>
<li>
<p><strong>Prompt B (on the right)</strong> - requires independent reasoning (fetching and combining different pieces of independent information). This prompt is typically less deterministic and allows us to leverage LLMs to provide alpha by uncovering insights that would be hard for a human to discover (or, at the very least, discover at scale). Instead of telling the agent what to do explicitly, we instead pose a question and expect the agent to execute an analysis and perform reasoning, without specific guidance or guardrails.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="openbb-platform">OpenBB Platform<a href="#openbb-platform" class="hash-link" aria-label="Direct link to OpenBB Platform" title="Direct link to OpenBB Platform">​</a></h2>
<p>Getting started with our Platform is extremely easy (docs <a href="https://docs.openbb.co/platform" target="_blank" rel="noopener noreferrer">here</a>). All you need is <code>pip install openbb</code> and you are ready to access 100+ different datasets.</p>
<p>We standardize the data so that you can read our docs once and interact with the Platform the same way, regardless of the type of data you are looking at.</p>
<p>In addition, using the OpenBB Hub, you can set up your API keys which we can manage on your behalf, and all you need to access data via OpenBB is a Personal Access Token.</p>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_2.png"></p>
<p>Crucially, we use Pydantic for all of our endpoints. This ensures that we have both structured inputs and structured outputs. This is extremely important as we feed these models into our agent so that it understands both the input schema during function calling, but also the output schema of the resulting function call. This is standardized across multiple data vendors across the OpenBB Platform.</p>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_3.png"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="openbb-tools">OpenBB Tools<a href="#openbb-tools" class="hash-link" aria-label="Direct link to OpenBB Tools" title="Direct link to OpenBB Tools">​</a></h3>
<p>From having 100+ different data endpoints that you can access using Python, we created &quot;tools&quot; that an agent &quot;understands&quot; and can use. This is extremely important since this collection of tools will give real-time data to the agent based on the prompt asked.</p>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_4.png"></p>
<p>Since the OpenBB Platform has high-quality documentation, we use each function&#x27;s docstring as well as the output field names (with some basic preprocessing). This tweak allows the agent to know where to get the market cap information from, even if it&#x27;s within a differently-named endpoint (for example the <code>equity.fundamentals.overview</code> endpoint).</p>
<p>Each of these tool descriptions is converted into embeddings that can be retrieved later on based on the query the user provides. This allows our agent to pick the right tools for the job - i.e. if I want to have access to Apple&#x27;s market cap, I want to get the tool <code>equity.fundamentals.overview</code> because I know that by providing the symbol <code>AAPL</code> I can get the market cap value.</p>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_5.png"></p>
<p>So, we create a vector store using FAISS (Facebook AI Similarity Search) and OpenAIEmbeddings, although any vector store with similarity search would also work.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="openbb-agent-architecture">OpenBB Agent Architecture<a href="#openbb-agent-architecture" class="hash-link" aria-label="Direct link to OpenBB Agent Architecture" title="Direct link to OpenBB Agent Architecture">​</a></h2>
<p align="center"><img width="900" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_6.png"></p>
<p>This is the overall architecture that our agent will follow, and below we will talk about each of these components individually.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task-decomposition">Task Decomposition<a href="#task-decomposition" class="hash-link" aria-label="Direct link to Task Decomposition" title="Direct link to Task Decomposition">​</a></h3>
<p>First of all, we don&#x27;t want to tackle the user query in one go. This is because LLMs have limited context. Plus, we want the agent to retrieve all the necessary tools to answer the query. But the vector&#x27;s store similarity search doesn&#x27;t work with one prompt that needs multiple different tools. Additionally, similar to human analysts, breaking a larger question up into smaller manageable subquestions leads to better analysis and results.</p>
<p>So, we break the user&#x27;s main query into:</p>
<ul>
<li>
<p><strong>List of simpler tasks</strong>: self-explanatory</p>
</li>
<li>
<p><strong>List of tasks dependency</strong>: does the current subtask need a prior subtask to tackle the current subtask?</p>
</li>
<li>
<p><strong>List of &quot;tool search&quot; keywords associated with each subtask</strong>: instead of using the subtask question itself to directly retrieve the correct selection of tools using the embeddings in the vector store, empirically we found that if the LLM could select the most important keywords associated with the task using keyword search. This ended up resulting in a big jump in retrieval performance. This is expected since we are effectively reducing the noise. E.g. &quot;What are Tesla peers&quot; → &quot;peers&quot;.</p>
</li>
</ul>
<p>This is the system message we are utilizing:</p>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_7.png"></p>
<p>To ensure that we have a structured output with the format specified, we create a Pydantic Data model to be used as format in the instruction:</p>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_8.png"></p>
<p>This is what the code looks like, and you can see that the <code>PydanticOutputParser</code> goes into the <code>format_instructions</code>:</p>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_9.png"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tool-retrieval">Tool Retrieval<a href="#tool-retrieval" class="hash-link" aria-label="Direct link to Tool Retrieval" title="Direct link to Tool Retrieval">​</a></h3>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_10.png"></p>
<p>This is the function that the agent uses to retrieve the right subset of tools to answer each of the subtasks. Empirically, we found good results by using the similarity score threshold of 0.65. In other words, we retrieve all tools with descriptions that return a better similarity score than that value. In the case where the search yields less than two tools, we return the 2 tools with the highest similarity score instead.</p>
<p>As previously mentioned, you can see that we are not using the subtask query itself but the keywords associated with it. The embeddings of the keywords are (from experimentation) closer to the embeddings of the correct docstring by focusing solely on a few keywords rather than the entire sentence.</p>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_11.png"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="subtask-agents">Subtask Agents<a href="#subtask-agents" class="hash-link" aria-label="Direct link to Subtask Agents" title="Direct link to Subtask Agents">​</a></h3>
<p>Each subtask agent is provided with the original query from the user, one of the subtasks from the task decomposition step, the output from another subtask agent IF there was a subtask dependency AND a set of retrieved tools necessary to answer the subtask.</p>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_12.png"></p>
<p>This is what the agent looks like:</p>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_13.png"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="final-agent">Final Agent<a href="#final-agent" class="hash-link" aria-label="Direct link to Final Agent" title="Direct link to Final Agent">​</a></h3>
<p>We then combine the entire context from subquestions and outputs to be given to the final agent:</p>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_14.png"></p>
<p>Finally, we give the final agent the main prompt and the list of tasks from task decomposition and that&#x27;s it!</p>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_15.png"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="openbb-results">OpenBB Results<a href="#openbb-results" class="hash-link" aria-label="Direct link to OpenBB Results" title="Direct link to OpenBB Results">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prompt-a">Prompt A<a href="#prompt-a" class="hash-link" aria-label="Direct link to Prompt A" title="Direct link to Prompt A">​</a></h3>
<p><em>&quot;Check what are TSLA peers. From those, check which one has the highest market cap. Then, on the ticker that has the highest market cap get the most recent price target estimate from an analyst, and tell me who it was and on what date the estimate was made.&quot;</em></p>
<p>The output can be seen here:</p>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_16.png"></p>
<p>Since this is a deterministic workflow, we can look at the raw data to check whether the output is correct or not - which we can validate below.</p>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_17.png"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prompt-b">Prompt B<a href="#prompt-b" class="hash-link" aria-label="Direct link to Prompt B" title="Direct link to Prompt B">​</a></h3>
<p><em>&quot;Perform a fundamentals financial analysis of AMZN using the most recently available data. What do you find that&#x27;s interesting?&quot;</em></p>
<p>The output can be seen here:</p>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_18.png"></p>
<p align="center"><img width="600" src="/blog/2023-12-27-creating-an-ai-powered-financial-analyst_19.png"></p>
<p>As can be seen above, the results are extremely impressive. We achieved this with a couple of weeks of work, but there are still a lot of areas that we can improve and in which we are currently working on. However, the current results make this an extremely exciting space to be.</p>
<p>All this work is open source and can be found on GitHub <a href="https://github.com/OpenBB-finance/openbb-agents" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>We are just getting started.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/openbb">openbb</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/ai">ai</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/llm">llm</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/agents">agents</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/copilot">copilot</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/function-calling">function-calling</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/pydantic">pydantic</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/langchain">langchain</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/DidierRLopes/my-website/tree/main/blog/2023-12-27-creating-an-ai-powered-financial-analyst.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/prediction-for-2024"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Prediction for 2024</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/the-new-finai-tech-stack"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">The new FinAI Tech Stack</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#ai-powered-financial-analyst-roadmap" class="table-of-contents__link toc-highlight">AI-Powered financial analyst roadmap</a></li><li><a href="#two-types-of-prompts" class="table-of-contents__link toc-highlight">Two types of prompts</a></li><li><a href="#openbb-platform" class="table-of-contents__link toc-highlight">OpenBB Platform</a><ul><li><a href="#openbb-tools" class="table-of-contents__link toc-highlight">OpenBB Tools</a></li></ul></li><li><a href="#openbb-agent-architecture" class="table-of-contents__link toc-highlight">OpenBB Agent Architecture</a><ul><li><a href="#task-decomposition" class="table-of-contents__link toc-highlight">Task Decomposition</a></li><li><a href="#tool-retrieval" class="table-of-contents__link toc-highlight">Tool Retrieval</a></li><li><a href="#subtask-agents" class="table-of-contents__link toc-highlight">Subtask Agents</a></li><li><a href="#final-agent" class="table-of-contents__link toc-highlight">Final Agent</a></li></ul></li><li><a href="#openbb-results" class="table-of-contents__link toc-highlight">OpenBB Results</a><ul><li><a href="#prompt-a" class="table-of-contents__link toc-highlight">Prompt A</a></li><li><a href="#prompt-b" class="table-of-contents__link toc-highlight">Prompt B</a></li></ul></li></ul></div></div></div></div></div><div class="mt-4"><footer class="bg-[#f8f9fa] dark:bg-[#000] text-[var(--ifm-footer-color)] pb-8"><div class="container container-fluid"><div class="row flex justify-center items-center"><div class="col text-center"><h4 class="mb-4">Let&#x27;s stay in touch.</h4><div class="flex justify-center space-x-4"><a href="https://twitter.com/didier_lopes" target="_blank" rel="noreferrer" class="text-black dark:text-white hover:text-ds-blue-primary dark:hover:text-ds-blue-accent"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" aria-label="Twitter"><title>Twitter</title><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></svg></a><a href="https://www.linkedin.com/in/didier-lopes/" target="_blank" rel="noreferrer" class="text-black dark:text-white hover:text-ds-blue-primary dark:hover:text-ds-blue-accent"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" aria-label="LinkedIn"><title>LinkedIn</title><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a><a href="https://github.com/DidierRLopes" target="_blank" rel="noreferrer" class="text-[#333] dark:text-[#f5f5f5] hover:text-ds-blue-primary dark:hover:text-ds-blue-accent"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" aria-label="GitHub"><title>GitHub</title><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a><a href="https://cal.com/didierlopes/15min" target="_blank" rel="noreferrer" class="text-black dark:text-white hover:text-ds-blue-primary dark:hover:text-ds-blue-accent" aria-label="Book a meeting"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" aria-label="Calendar"><title>Cal.com</title><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zM9 14H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2zm-8 4H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2z"></path></svg></a></div></div></div></div></footer></div></div>
</body>
</html>